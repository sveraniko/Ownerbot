# PROJECT_BASE.md
> SIS (Shop-in-Shop / ‚ÄúBusiness in Pocket‚Äù for Telegram) ‚Äî –±–∞–∑–æ–≤–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –±–∞–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞.  
> –≠—Ç–æ—Ç —Ñ–∞–π–ª –ø–∏—à–µ—Ç—Å—è –¥–ª—è –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç **–º–µ–Ω—è—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –Ω–µ —Å–ª–æ–º–∞—Ç—å –µ–≥–æ**, –∏ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ (Codex/Qoder), –∫–æ—Ç–æ—Ä—ã–º –Ω–∞–¥–æ –±—ã—Å—Ç—Ä–æ ‚Äú—Å—Ö–≤–∞—Ç–∏—Ç—å‚Äù –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã.

---

## 0) TL;DR (–µ—Å–ª–∏ —É —Ç–µ–±—è 60 —Å–µ–∫—É–Ω–¥)
- SIS = **Telegram‚Äënative** commerce engine: –∫–∞—Ç–∞–ª–æ–≥, –∫–æ—Ä–∑–∏–Ω–∞, –æ–ø–ª–∞—Ç—ã, –∑–∞–∫–∞–∑—ã, –∞–¥–º–∏–Ω–∫–∞ **–≤ Telegram**, ops‚Äë—á–∞—Ç—ã –≤–º–µ—Å—Ç–æ web‚Äë—Ç–∏–∫–µ—Ç–æ–≤, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞–∫ —Å–ª–æ–π.
- **Baseline‚Äëfirst**: –ª—é–±—ã–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è/—Ç–∞–±–ª–∏—Ü—ã –¥–æ–±–∞–≤–ª—è–µ–º –≤ `0001_baseline.py`, –±–µ–∑ ‚Äú–ø–æ—Ç–æ–º –º–∏–≥—Ä–∞—Ü–∏–µ–π‚Äù. –ü–æ–¥–Ω—è—Ç–∏–µ —Å –Ω—É–ª—è –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ–≥–¥–∞.
- **Access Model**: –≥–ª–æ–±–∞–ª—å–Ω—ã–π gate (–º–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç/–∑–∞–∫—Ä—ã—Ç) + per‚Äëtarget –ø–æ–ª–∏—Ç–∏–∫–∏ (VIEW/BUY/CONTENT) —á–µ—Ä–µ–∑ `TargetAccessService` –∏ UI‚Äë—Å–ª–æ–π `TargetGuard`.
- **Deposit/Preorder**: staged‚Äëpayments (FULL/DEPOSIT/PREORDER), —Å—Ç—Ä–æ–≥–∏–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç: **–Ω–µ–ª—å–∑—è –º–µ—à–∞—Ç—å —Ä–∞–∑–Ω—ã–µ payment terms –≤ –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–µ/–∑–∞–∫–∞–∑–µ**.
- **AutoNudge**: worker –∞–≤—Ç–æ–º–∞—Ç–æ–º –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø—Ä–æ –æ–ø–ª–∞—Ç—É (–≤ DM/ops) –∏ –¥–µ–ª–∞–µ—Ç digest –≤ –∞–¥–º–∏–Ω —á–∞—Ç (—Å –¥–µ–¥—É–ø–æ–º).
- **Content**: –∫–æ–Ω—Ç–µ–Ω—Ç –≤—ã–¥–∞—ë—Ç—Å—è –∫–∞–∫ ‚Äú–±–∏–±–ª–∏–æ—Ç–µ–∫–∞‚Äù –≤–Ω—É—Ç—Ä–∏ –∑–∞–∫–∞–∑–∞ + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ CONTENT + –ø—Ä–æ–¥–ª–µ–Ω–∏–µ (renew) –ø—Ä–∏ –∏—Å—Ç–µ–∫—à–µ–º –¥–æ—Å—Ç—É–ø–µ.
- **UI**: —è–∫–æ—Ä–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ (Welcome/Prompt) –¥–æ–ª–∂–Ω—ã **–Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è** –∏ –Ω–µ –ª–æ–º–∞—Ç—å reply‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É. Support‚Äë—á–∞—Ç —á–∏—Å—Ç–∏—Ç—Å—è —á–µ—Ä–µ–∑ Redis‚Äë–ø–∞—Ç—Ç–µ—Ä–Ω ‚Äú–¥–∏–∞–ø–∞–∑–æ–Ω message_id‚Äù.

---

## 1) –ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –∏–¥–µ—è (—á—Ç–æ –º—ã —Å—Ç—Ä–æ–∏–º)
### 1.1. –ß—Ç–æ SIS –¥–µ–ª–∞–µ—Ç –ª—É—á—à–µ, —á–µ–º ‚Äú–±–æ—Ç + WooCommerce‚Äù
- **No-web admin**: –∞–¥–º–∏–Ω–∫–∞ –∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–∫–∞ –∂–∏–≤—É—Ç –≤ Telegram. –ù–∏–∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç ‚Äú–≤–∫–ª–∞–¥–∫—É —á–∞—Ç–∞‚Äù –≤ –≤–µ–±‚Äë–∞–¥–º–∏–Ω–∫–µ, –∫–æ–≥–¥–∞ –±–∏–∑–Ω–µ—Å –≥–æ—Ä–∏—Ç –≤ 03:00.
- **Ops-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –∑–∞–∫–∞–∑—ã, –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç, ‚Äú–≤–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É‚Äù ‚Äî –ª–µ—Ç—è—Ç –≤ Telegram‚Äë—á–∞—Ç—ã/–≥—Ä—É–ø–ø—ã.
- **Trust/Access/Club**: –¥–æ—Å—Ç—É–ø—ã –∫ —Ç–æ–≤–∞—Ä–∞–º/–ª—É–∫–∞–º/–∫–æ–Ω—Ç–µ–Ω—Ç—É, –∫–ª—É–±–Ω—ã–µ –º–æ–¥–µ–ª–∏, –∫–ª—é—á–∏, entitlements, renew.
- **–ò–Ω—Ñ–æ–±–∏–∑–Ω–µ—Å/–∫–æ–Ω—Ç–µ–Ω—Ç**: –ª—É–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å ‚Äú–∫—É—Ä—Å–∞–º–∏‚Äù, —Ç–æ–≤–∞—Ä—ã ‚Äî ‚Äú–±–ª–æ–∫–∞–º–∏‚Äù, –∫–æ–Ω—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—Ç–µ–∫–∞—Ç—å, –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å—Å—è.
- **Staged payment**: –¥–µ–ø–æ–∑–∏—Ç / –ø—Ä–µ–¥–∑–∞–∫–∞–∑ / –¥–æ–ø–ª–∞—Ç–∞ –æ—Å—Ç–∞—Ç–∫–∞ ‚Äî —Å–µ–π—á–∞—Å —ç—Ç–æ must‚Äëhave –¥–ª—è –≤—ã–∂–∏–≤—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.

### 1.2. –ù–µ —Ü–µ–ª—å
- –î–µ–ª–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ‚Äú–∫–æ–º–±–∞–π–Ω‚Äù —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏ –≤ UI, –≥–¥–µ –∞–¥–º–∏–Ω —É—Ç–æ–Ω–µ—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
- –¢—è–Ω—É—Ç—å WooCommerce/WordPress –∫–∞–∫ ‚Äú–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è‚Äù (—ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –∞–¥–∞: —Ö–æ—Å—Ç–∏–Ω–≥, –ø–ª–∞–≥–∏–Ω—ã, –≤–µ–±—Ö—É–∫–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å).

---

## 2) –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∞ (–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã)
### 2.1. Baseline‚Äëfirst (–≥–ª–∞–≤–Ω—ã–π –∑–∞–∫–æ–Ω)
- –ï—Å–ª–∏ –∫–æ–¥ –Ω–∞—á–∏–Ω–∞–µ—Ç **–ø–∏—Å–∞—Ç—å/—á–∏—Ç–∞—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ** –∏–∑ –ë–î, —ç—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞–Ω–æ –±—ã—Ç—å –≤ `app/infrastructure/migrations/versions/0001_baseline.py`.
- –õ—é–±–æ–π PR –æ–±—è–∑–∞–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: **drop DB ‚Üí create DB ‚Üí bootstrap ‚Üí bot —Å—Ç–∞—Ä—Ç—É–µ—Ç**.
- –¢–µ—Å—Ç—ã/—Ñ–∏–∫—Å—Ç—É—Ä—ã, –≥–¥–µ `create_all()` –ø–µ—Ä–µ—á–∏—Å–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –≤—Ä—É—á–Ω—É—é, —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω—ã.

### 2.2. Additive changes only (–±–µ–∑ ‚Äú–≤—ã—Ä–µ–∑–∞–ª –∏ —Å—Ç–∞–ª–æ –ø—Ä–æ—â–µ‚Äù)
- –ù–∏–∫–∞–∫–∏—Ö ‚Äú—É–¥–∞–ª–∏–ª —Å—Ç–∞—Ä—ã–π –∫–æ–¥, –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω‚Äù. –í SIS —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –æ–±—ã—á–Ω–æ –Ω—É–∂–µ–Ω, –ø—Ä–æ—Å—Ç–æ —Ç—ã –µ—â—ë –Ω–µ –ø–æ–Ω—è–ª –≥–¥–µ.
- –ï—Å–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–µ–æ–±—Ö–æ–¥–∏–º: —Ç–æ–ª—å–∫–æ **—á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä**, —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö entrypoints.

### 2.3. Telegram‚ÄëUI –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –æ—Å—å
- –õ—é–±–æ–π UX —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö Telegram:
  - reply keyboard –∏ inline keyboard –≤–µ–¥—É—Ç —Å–µ–±—è –ø–æ‚Äë—Ä–∞–∑–Ω–æ–º—É;
  - ‚Äú–Ω–µ–≤–∏–¥–∏–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è‚Äù –∏ ‚Äú—É–¥–∞–ª–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏‚Äù —á–∞—Å—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ;
  - –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–∞–∂–µ–Ω (—è–∫–æ—Ä–Ω—ã–µ –ø–∞–Ω–µ–ª–∏).

### 2.4. One source of truth
- –î–ª—è staged payments: —Ä–∞—Å—á—ë—Ç ‚Äú—Å–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å‚Äù –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ —á–µ—Ä–µ–∑ **–æ–¥–∏–Ω –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π helper** (staged‚Äë–º–æ–¥—É–ª—å), –∞ –Ω–µ —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏ –≤ checkout/payforme/orders-panel.
- –î–ª—è access: —Ä–µ—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–∞–Ω–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ `TargetAccessService`, UI —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç.

---

## 3) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤ –¥–≤—É—Ö —Å–ª–æ—è—Ö)
### 3.1. –°–ª–æ–∏
- `app/bot/**`  
  Telegram UI: handlers/routers, keyboards, ‚Äú–ø–∞–Ω–µ–ª–∏‚Äù, message cleanup, callback contracts.
- `app/domain/**`  
  –ë–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞: —Å–µ—Ä–≤–∏—Å—ã –∑–∞–∫–∞–∑–æ–≤, –∫–æ—Ä–∑–∏–Ω—ã, –æ–ø–ª–∞—Ç, access control, looks v2.
- `app/infrastructure/**`  
  ORM –º–æ–¥–µ–ª–∏, baseline migration, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ storage/redis, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
- `app/core/**`  
  —Ñ–æ–Ω–æ–≤—ã–µ –≤–æ—Ä–∫–µ—Ä—ã/—Ç–∞—Å–∫–∏ (expiration, snapshot/metrics, autonudge), wiring.
- `app/analytics/**`  
  event catalog, emitters, —Å—Ö–µ–º—ã —Å–≤–æ–π—Å—Ç–≤ —Å–æ–±—ã—Ç–∏–π.
- `tests/**` –∏ `app/tests/**`  
  unit/integration, baseline parity, cold start.

### 3.2. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (runtime)
- Postgres (prod/dev)
- Redis (FSM + ‚Äú–¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ‚Äù UI/–¥–∏–∞–ª–æ–≥–∏/–¥–µ–¥—É–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è, –≥–¥–µ –Ω—É–∂–Ω–æ)
- MinIO (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —Ñ–∞–π–ª–æ–≤; –Ω–∞ dev —á–∞—Å—Ç–æ Telegram storage)

---

## 4) –ö–∞—Ç–∞–ª–æ–≥/–õ—É–∫–∏/–¢–æ–≤–∞—Ä—ã: —Å—É—â–Ω–æ—Å—Ç–∏ –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ ‚Äú–∫–∏—Ä–ø–∏—á–∏‚Äù
### 4.1. Product (—Ç–æ–≤–∞—Ä)
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º –∏–ª–∏ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω—ã–º (–≤–∞—Ä–∏–∞–Ω—Ç—ã/–∫–æ–º–±–∏–Ω–∞—Ü–∏–∏).
- –ò–º–µ–µ—Ç:
  - –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–≤ –∫–∞—Ä—Ç–æ—á–∫–µ)
  - –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É (—á–µ—Ä–µ–∑ ‚Äú–ï—â—ë‚Äù)
  - –∫–æ–Ω—Ç–µ–Ω—Ç (—á–µ—Ä–µ–∑ ‚Äú–ü–æ–¥—Ä–æ–±–Ω–µ–µ‚Äù, —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π)

### 4.2. Look (–ª—É–∫) = –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
- –í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –º–∞–≥–∞–∑–∏–Ω–µ: –Ω–∞–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ (outfit).
- –í –∏–Ω—Ñ–æ–±–∏–∑–Ω–µ—Å–µ: **–∫—É—Ä—Å**:
  - look = –∫—É—Ä—Å/–ø–∞–∫–µ—Ç
  - product = –±–ª–æ–∫/–º–æ–¥—É–ª—å
  - ‚Äú–°–æ—Å—Ç–∞–≤‚Äù = —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤ + –±—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

### 4.3. Course Mode (—Ä–µ–∂–∏–º –∫—É—Ä—Å–∞)
- –†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ñ–ª–∞–≥–æ–º** (`looks.flags["is_course"]`), –±–µ–∑ ‚Äú–ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –≤–∏–∑–∞—Ä–¥‚Äù.
- –ò–∑–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ presentation —Å–ª–æ—è ‚Äúcomposition‚Äù:
  - –∑–∞–≥–æ–ª–æ–≤–∫–∏/–ª–µ–≥–µ–Ω–¥–∞: ‚Äúüìö –ë–ª–æ–∫–∏ –∫—É—Ä—Å–∞‚Äù
  - —Ñ–∏–ª—å—Ç—Ä—ã: all/locked/available/expired
  - –±—ã—Å—Ç—Ä—ã–µ CTA: –∫—É–ø–∏—Ç—å/–ø—Ä–æ–¥–ª–∏—Ç—å (–Ω–µ –ª–æ–º–∞—è callback –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞)

---

## 5) Access Model (–¥–æ—Å—Ç—É–ø—ã)
### 5.1. –î–≤–∞ —É—Ä–æ–≤–Ω—è –∫–æ–Ω—Ç—Ä–æ–ª—è
1) **Global gate**: –æ–±—â–∏–π ‚Äú–º–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç/–∑–∞–∫—Ä—ã—Ç‚Äù (Business.access_control_enabled)  
   –≠—Ç–æ –≥—Ä—É–±—ã–π —Ä—É–±–∏–ª—å–Ω–∏–∫.
2) **Per-target policies (LEVELS)**: –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ü–µ–ª–µ–π:
   - target_type: PRODUCT / LOOK / ‚Ä¶  
   - action: VIEW / BUY / CONTENT  
   - –ø–æ–ª–∏—Ç–∏–∫–∞ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ—à–∞—Ç—å public/club/entitlement/key_offer –∏ —Ç.–¥.

### 5.2. –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å
- `app/domain/access_control/target_access_service.py` (–∏–º—è –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è, –Ω–æ –ø—Ä–∏–Ω—Ü–∏–ø –Ω–µ–∏–∑–º–µ–Ω–µ–Ω):
  - `check_target_access(...)` ‚Üí `TargetAccessDecision`
- –†–µ—à–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç:
  - allow/deny + reason
  - expiry semantics (–∏—Å—Ç—ë–∫ –¥–æ—Å—Ç—É–ø) + `renew_supported`
- UI —Å–ª–æ–π –Ω–µ ‚Äú—Ä–µ—à–∞–µ—Ç‚Äù, UI —Å–ª–æ–π **—Ä–∏—Å—É–µ—Ç**.

### 5.3. UI —Å–ª–æ–π
- `app/bot/access/target_guard.py`
- `TargetGuard.render_locked_screen(...)`:
  - –µ–¥–∏–Ω—ã–π locked UI (üîí / ‚åõ –∏—Å—Ç—ë–∫ / renew CTA)
  - CTA: –≤–≤–µ—Å—Ç–∏ –∫–ª—é—á / –∫—É–ø–∏—Ç—å / –ø—Ä–æ–¥–ª–∏—Ç—å / –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–ª—É–± –∏ —Ç.–ø.

### 5.4. TTL –∏ renew
- ‚Äú–ö–ª—é—á–∏ –∏–º–µ—é—Ç —Å—Ä–æ–∫‚Äù ‚â† ‚Äú–∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–∫–∞–∑–µ –∏–º–µ–µ—Ç —Å—Ä–æ–∫‚Äù –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ú–æ–¥–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:
  - –¥–æ—Å—Ç—É–ø –∫ target –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è entitlement/grant —Å expiry
  - –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø –∏—Å—Ç—ë–∫ ‚Üí UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç renew
  - renew –≤—ã–¥–∞—ë—Ç –Ω–æ–≤—ã–π entitlement/grant (–ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –ø–æ–ª–∏—Ç–∏–∫–∏), –∞ –Ω–µ ‚Äú–æ–±–º–∞–Ω—ã–≤–∞–µ—Ç UI‚Äù.

---

## 6) Orders ‚Üí Content Library (–∫–æ–Ω—Ç–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –∑–∞–∫–∞–∑–æ–≤)
### 6.1. –ò–¥–µ—è
- –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –∂–∏—Ç—å ‚Äú–≥–¥–µ-—Ç–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ‚Äù –∏ —Ç–µ—Ä—è—Ç—å—Å—è.
- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ **–∑–∞–∫–∞–∑–∞**:
  - –∑–∞–∫–∞–∑ ‚Üí üìö –ö–æ–Ω—Ç–µ–Ω—Ç ‚Üí —Å–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç

### 6.2. –î–æ—Å—Ç—É–ø
- –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ–±—è–∑–∞–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ `TargetGuard` —Å `TargetAction.CONTENT`.
- –ï—Å–ª–∏ denied:
  - –ø–æ–∫–∞–∑–∞—Ç—å locked screen (–∏ –µ—Å–ª–∏ –∏—Å—Ç—ë–∫ ‚Üí renew CTA)
- –ï—Å–ª–∏ allowed:
  - –ø–æ–∫–∞–∑–∞—Ç—å blocks/audio/links (–∫–∞–∫ —Å–µ–π—á–∞—Å —É—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö ‚Äú–ü–æ–¥—Ä–æ–±–Ω–µ–µ‚Äù)

### 6.3. –ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ ‚Äú–∫—É—Ä—Å = –ª—É–∫‚Äù
- –õ—É–∫ (–∫—É—Ä—Å) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äú–°–æ—Å—Ç–∞–≤/–ë–ª–æ–∫–∏ –∫—É—Ä—Å–∞‚Äù
- –ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Ç–æ–≤–∞—Ä–∞ (product) –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø CONTENT (–∫—É–ø–ª–µ–Ω/–∑–∞–∫—Ä—ã—Ç/–∏—Å—Ç—ë–∫)
- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∑–∞–∫–∞–∑–∞—Ö –ø–æ —Ñ–∞–∫—Ç—É ‚Äú–≤ —ç—Ç–æ–º –∑–∞–∫–∞–∑–µ –µ—Å—Ç—å —ç—Ç–∏ –±–ª–æ–∫–∏‚Äù.

---

## 7) Payments: FULL / DEPOSIT / PREORDER (—Å—Ç–µ–π–¥–∂-–º–∞—à–∏–Ω–∞)
### 7.1. –ó–∞—á–µ–º
- –†—ã–Ω–æ–∫ –ø–∞–¥–∞–µ—Ç, ‚Äú–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –Ω–∞ —Å–∫–ª–∞–¥‚Äù —á–∞—Å—Ç–æ —Å–º–µ—Ä—Ç—å.
- –ù—É–∂–Ω—ã:
  - –ø—Ä–µ–¥–∑–∞–∫–∞–∑ (0 —Å–µ–π—á–∞—Å)
  - –¥–µ–ø–æ–∑–∏—Ç (—á–∞—Å—Ç—å —Å–µ–π—á–∞—Å)
  - –¥–æ–ø–ª–∞—Ç–∞ –æ—Å—Ç–∞—Ç–∫–∞ –ø–æ–∑–∂–µ
  - –∞–≤—Ç–æ–Ω—É–¥–∂–∏ –∏ –º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–µ —Å–≤–æ–¥–∫–∏

### 7.2. –ì–ª–∞–≤–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
- –í –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–µ/–∑–∞–∫–∞–∑–µ **–æ–¥–∏–Ω payment mode**.
- ‚Äú–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –ª—É–∫–µ‚Äù –Ω–µ –¥–æ–ª–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏/–ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞–º–∏ (–µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç ‚Äî –∑–∞–ø—Ä–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–¥–º–∏–Ω–∞/–≤–∞–ª–∏–¥–∞—Ü–∏–∏).
- ‚ÄúDeposit non-refundable‚Äù —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π/–ø–æ–ª–∏—Ç–∏–∫–æ–π, –≤–æ–∑–≤—Ä–∞—Ç—ã —É—Å–ª–æ–∂–Ω—è—é—Ç —Å–∏—Å—Ç–µ–º—É –∏ —Å–µ–π—á–∞—Å –Ω–µ —Ü–µ–ª—å.

### 7.3. –ì–¥–µ –∂–∏–≤—ë—Ç –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–æ–≤
- `app/domain/shop/payments/staged.py`:
  - payment stages (`pending`, `deposit_due`, `balance_due`, `preorder`, `fully_paid`)
  - `compute_upfront_due(...)`
  - `compute_stage(...)`
  - `compute_due_now(...)`  (—Ç–æ, —á—Ç–æ –ø–ª–∞—Ç–∏–º ‚Äú—Å–µ–π—á–∞—Å‚Äù)
- –õ—é–±–æ–π UI/flow, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äú–∫ –æ–ø–ª–∞—Ç–µ —Å–µ–π—á–∞—Å‚Äù, –¥–æ–ª–∂–µ–Ω –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ staged‚Äëhelper, –∞ –Ω–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ ‚Äú–µ—Å–ª–∏ preorder —Ç–æ ‚Ä¶‚Äù.

### 7.4. UX –ø—Ä–∏–Ω—Ü–∏–ø—ã
- ‚Äú–û–ø–ª–∞—Ç–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫‚Äù –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
  - –≤ –∑–∞–∫–∞–∑–µ (–∫–Ω–æ–ø–∫–∞/CTA)
  - –ø–æ–Ω—è—Ç–Ω–∞—è —Å—É–º–º–∞ ‚Äú–∫ –æ–ø–ª–∞—Ç–µ —Å–µ–π—á–∞—Å‚Äù
  - PayForMe –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –æ—Å—Ç–∞—Ç–∫–∞ (–µ—Å–ª–∏ due_now > 0)

---

## 8) AutoNudge (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
### 8.1. –¶–µ–ª—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–≥–æ–Ω—è—Ç—å –æ–ø–ª–∞—Ç—É:
  - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (DM) –ø–æ —Å—Ç–∞–¥–∏—è–º –æ–ø–ª–∞—Ç—ã
  - –º–µ–Ω–µ–¥–∂–µ—Ä—É/ops (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –î–∞–≤–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü—É/ops digest, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑–≥—Ä–µ–±–∞–Ω–∏—è.

### 8.2. –ì–¥–µ –∂–∏–≤—ë—Ç
- Worker: `app/core/tasks.py` (AutoNudgeWorker)
- State/dedupe: ORM —Ç–∞–±–ª–∏—Ü–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä `AutoNudgeDigestState`) + baseline
- Analytics: —Å–æ–±—ã—Ç–∏—è AUTO_NUDGE_* + DIGEST_* (–∫–∞—Ç–∞–ª–æ–≥ —Å–æ–±—ã—Ç–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)

### 8.3. –ü—Ä–∏–Ω—Ü–∏–ø ‚Äú–Ω–µ –ª–æ–º–∞—Ç—å –æ–ø–ª–∞—Ç—É‚Äù
- AutoNudge –Ω–µ –¥–æ–ª–∂–µ–Ω –º–µ–Ω—è—Ç—å payment‚Äë—Å—Ç–∞—Ç—É—Å—ã.
- –û–Ω —Ç–æ–ª—å–∫–æ:
  - —á–∏—Ç–∞–µ—Ç staged —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞
  - –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–º—É/—á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
  - –ø–∏—à–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É/–¥–µ–¥—É–ø

---

## 9) UI/State: ‚Äú—è–∫–æ—Ä–Ω—ã–µ –ø–∞–Ω–µ–ª–∏‚Äù, cleanup –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –±–æ–ª–∏—Ç
### 9.1. –ß—Ç–æ —Ç–∞–∫–æ–µ ‚Äú—è–∫–æ—Ä—å‚Äù
- Welcome/Legend + Catalog prompt –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
  - –≤—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—Ö—É
  - –±–µ–∑ –¥—É–±–ª–µ–π
  - –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ edit‚Äëin‚Äëplace, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ (catalog ‚Üí admin ‚Üí wizard ‚Üí catalog) –Ω–µ–ª—å–∑—è —Ç–µ—Ä—è—Ç—å message_id —è–∫–æ—Ä–µ–π, –∏–Ω–∞—á–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥—É–±–ª—è–∂.

### 9.2. –ü–æ—á–µ–º—É –ª–æ–º–∞–µ—Ç—Å—è
- –ö–æ–≥–¥–∞ message_id —è–∫–æ—Ä–µ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ FSM, –∞ –ø–æ—Ç–æ–º –¥–µ–ª–∞–µ—Ç—Å—è `state.clear()`, —Å—Å—ã–ª–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è.
- –õ—é–±–æ–π ‚Äú–≥–ª–æ–±–∞–ª—å–Ω—ã–π cleanup everywhere‚Äù –ø–æ—á—Ç–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ª–æ–º–∞–µ—Ç reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.

### 9.3. –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (Support)
- Support chat —Ö—Ä–∞–Ω–∏—Ç message_id –≤ Redis —Å TTL –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º first/last.
- Cleanup –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ (home).
- –í—ã–≤–æ–¥: –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö UI IDs, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å state.clear(), **Redis‚Äë–ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞–¥—ë–∂–Ω–µ–µ** FSM.

> –î–µ—Ç–∞–ª—å–Ω–æ: —ç—Ç–æ –±—É–¥–µ—Ç –≤ `UI_STATE_POLICY.md`. –ó–¥–µ—Å—å —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏–Ω—Ü–∏–ø.

---

## 10) –ê–¥–º–∏–Ω–∫–∞ –≤ Telegram (–ø–æ—á–µ–º—É owner-only –Ω–∞ –æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è)
- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ payment terms –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è—é—Ç –Ω–∞ –≤—ã—Ä—É—á–∫—É.
- –ü–æ—ç—Ç–æ–º—É —á–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **owner-only**, –∞ –Ω–µ ‚Äú–ª—é–±–æ–π –∞–¥–º–∏–Ω‚Äù.
- –õ—é–±—ã–µ –Ω–æ–≤—ã–µ –∞–¥–º–∏–Ω‚Äë—Ñ–∏—á–∏ –¥–æ–ª–∂–Ω—ã:
  - –±—ã—Ç—å –æ—á–µ–≤–∏–¥–Ω—ã–º–∏ (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ‚Äúpolicy –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç = public‚Äù)
  - –∏–º–µ—Ç—å fail‚Äëopen –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ (—á—Ç–æ–±—ã –º–∞–≥–∞–∑–∏–Ω –Ω–µ ‚Äú—É–º–µ—Ä‚Äù –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

---

## 11) Analytics (—Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è ‚Äú–∑–∞–±—ã—Ç—å‚Äù)
- –õ—é–±–æ–π –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç –Ω–∞:
  - –¥–æ—Å—Ç—É–ø (granted/denied/expired/renew)
  - –æ–ø–ª–∞—Ç—É (due_now, stage)
  - autonudge (sent/failed/skipped, digest)
  –¥–æ–ª–∂–µ–Ω –ø–∏—Å–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π.
- –í—Å–µ –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ event catalog (—Å—Ö–µ–º—ã —Å–≤–æ–π—Å—Ç–≤), –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —Ö–∞–æ—Å –≤ –æ—Ç—á—ë—Ç–∞—Ö owner‚Äë–±–æ—Ç–∞.

---

## 12) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
### 12.1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä ‚Äú–Ω–µ —É–±–∏—Ç—å –ø—Ä–æ–µ–∫—Ç‚Äù
- cold start baseline (DB –ø—É—Å—Ç–∞—è ‚Üí –ø–æ–¥–Ω—è–ª–æ—Å—å)
- –±–∞–∑–æ–≤—ã–µ —Ä–æ—É—Ç–µ—Ä—ã –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è
- –∫–æ—Ä–∑–∏–Ω–∞/checkout –Ω–µ –ª–æ–º–∞—é—Ç—Å—è
- access guard –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç public –±–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏
- staged payment —Ä–∞—Å—á—ë—Ç—ã –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã –º–µ–∂–¥—É UI/flows

### 12.2. –ß—Ç–æ —Ç–µ—Å—Ç–∞–º–∏ –ª–æ–≤–∏–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- JSON‚Äë–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å FSM (Decimal/ORM –≤ FSM = —Å–º–µ—Ä—Ç—å)
- –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç ‚Äúno mixed payment modes‚Äù
- per-target CONTENT access decisions + renew UI

---

## 13) –ì–ª–æ—Å—Å–∞—Ä–∏–π (—á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç—ã –Ω–µ —Ç—É–ø–∏–ª–∏)
- **Legend / Welcome**: –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ‚Äú–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å‚Äù.
- **Prompt / Catalog**: –ø–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π/–º–µ–Ω—é –∫–∞—Ç–∞–ª–æ–≥–∞.
- **Carrier message**: ‚Äú—Å–ª—É–∂–µ–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Äù –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ reply‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é).
- **Target**: –æ–±—ä–µ–∫—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (product/look).
- **Action**: VIEW / BUY / CONTENT.
- **Entitlement**: –≤—ã–¥–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø (–æ–±—ã—á–Ω–æ —Å–æ —Å—Ä–æ–∫–æ–º).
- **Grant / Key**: –≤—ã–¥–∞—á–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –∫–ª—é—á–∏/–æ—Ñ—Ñ–µ—Ä—ã.
- **Staged payments**: –ø–ª–∞—Ç–µ–∂–∏ —á–∞—Å—Ç—è–º–∏ (–¥–µ–ø–æ–∑–∏—Ç/–ø—Ä–µ–¥–∑–∞–∫–∞–∑/–æ—Å—Ç–∞—Ç–æ–∫).
- **AutoNudge**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ.
- **Digest**: —Å–≤–æ–¥–∫–∞ –≤ ops/admin —á–∞—Ç.

---

## 14) ‚Äú–ß—Ç–æ –¥–∞–ª—å—à–µ‚Äù (—Ä–µ—Ñ–µ—Ä–µ–Ω—Å-—Ä–æ–∞–¥–º–∞–ø)
> –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª intentionally high-level, –¥–µ—Ç–∞–ª–∏ –±—É–¥—É—Ç –≤ `PR_STACK.md`.

–ë–ª–∏–∂–∞–π—à–∏–µ —Ç–µ–º—ã:
- UI_STATE_POLICY.md: –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ UI IDs (FSM vs Redis) –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏.
- ACCESS_MODEL.md: –µ–¥–∏–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ gate + per-target policies + renew + –∫–æ–Ω—Ç–µ–Ω—Ç.
- PR_STACK.md: —Å–ø–∏—Å–æ–∫ PR‚Äô–æ–≤ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏.

---

## 15) –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é (–æ—Ä–∏–µ–Ω—Ç–∏—Ä—ã)
- Baseline: `app/infrastructure/migrations/versions/0001_baseline.py`
- TargetGuard: `app/bot/access/target_guard.py`
- Target access service: `app/domain/access_control/target_access_service.py`
- Staged payments helper: `app/domain/shop/payments/staged.py`
- Orders service (–∫—Ä—É–ø–Ω—ã–π): `app/domain/shop/orders/service.py`
- Workers: `app/core/tasks.py`
- Analytics catalog: `app/analytics/event_catalog.py`

---

## 16) –ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
- –õ—é–±–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è/–∞–≥–µ–Ω—Ç –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π —á–∏—Ç–∞–µ—Ç:
  - `AGENTS.md`
  - `PROJECT_BASE.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
  - –∏ –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ policy‚Äë—Ñ–∞–π–ª—ã, –∫–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è.
- –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç –Ω–µ —É–≤–µ—Ä–µ–Ω: –¥–µ–ª–∞–µ—Ç **audit/report** –≤–º–µ—Å—Ç–æ ‚Äú—è —â–∞—Å –ø–µ—Ä–µ–ø–∏—à—É –ø–æ–ª–æ–≤–∏–Ω—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å—Ç–∞–Ω–µ—Ç –ª—É—á—à–µ‚Äù.

